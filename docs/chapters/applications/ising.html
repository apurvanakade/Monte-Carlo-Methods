<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-03-11">

<title>14&nbsp; Ising Model – Monte Carlo Methods Lecture Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/applications/mmn.html" rel="next">
<link href="../../chapters/applications/SDE.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ef56b68f8fa1e9d2ba328e99e439f80.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-db446d54fd5a772fc03f6e5780a6993c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-ee81c25b5e6cf3f6942c6f9c45799924.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-db446d54fd5a772fc03f6e5780a6993c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../style.css">
<meta property="og:title" content="14&nbsp; Ising Model – Monte Carlo Methods Lecture Notes">
<meta property="og:description" content="">
<meta property="og:image" content="ising_files/figure-html/cell-3-output-1.png">
<meta property="og:site_name" content="Monte Carlo Methods Lecture Notes">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Monte Carlo Methods Lecture Notes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/apurvanakade/Monte-Carlo-Methods"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/applications/SDE.html">Applications</a></li><li class="breadcrumb-item"><a href="../../chapters/applications/ising.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Ising Model</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Welcome</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Monte Carlo Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Monte Carlo Estimation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/estimation/estimating_pi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Estimating <span class="math inline">\(\pi\)</span></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/estimation/integrals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Estimating Integrals</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sampling/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampling Techniques</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sampling/rng.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Random Number Generators</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sampling/discrete.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Discrete Distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sampling/inverse_transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Inverse Transform Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sampling/other_distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Other Distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sampling/accept_reject.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Rejection Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sampling/gibbs_2d.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Gibbs Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sampling/mh.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Metropolis–Hastings Algorithm</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/variance_reduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Variance Reduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Applications</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/applications/SDE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Stochastic Differential Equations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/applications/ising.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Ising Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/applications/mmn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">M/M/n Queue</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/applications/bootstrap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Bootstrap</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/dynamical/kalman_filters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Kalman Filters</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/dynamical/particle_filters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">particle_filters.html</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Optimization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/optimization/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">index.html</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/optimization/simulated_annealing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">simulated_annealing.html</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/optimization/cross_entropy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">cross_entropy.html</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../appendices/probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Review of Probability Theory</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../appendices/markov_chains.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Markov Chains</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../appendices/hidden_markov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Hidden Markov Chains</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-physical-ising-model" id="toc-the-physical-ising-model" class="nav-link active" data-scroll-target="#the-physical-ising-model"><span class="header-section-number">14.1</span> The Physical Ising Model</a></li>
  <li><a href="#the-mathematical-ising-model" id="toc-the-mathematical-ising-model" class="nav-link" data-scroll-target="#the-mathematical-ising-model"><span class="header-section-number">14.2</span> The Mathematical Ising Model</a>
  <ul class="collapse">
  <li><a href="#hamiltonian" id="toc-hamiltonian" class="nav-link" data-scroll-target="#hamiltonian"><span class="header-section-number">14.2.1</span> Hamiltonian</a></li>
  <li><a href="#boltzmann-distribution" id="toc-boltzmann-distribution" class="nav-link" data-scroll-target="#boltzmann-distribution"><span class="header-section-number">14.2.2</span> Boltzmann Distribution</a></li>
  <li><a href="#low-temperature" id="toc-low-temperature" class="nav-link" data-scroll-target="#low-temperature"><span class="header-section-number">14.2.3</span> Low Temperature</a></li>
  <li><a href="#magnetization" id="toc-magnetization" class="nav-link" data-scroll-target="#magnetization"><span class="header-section-number">14.2.4</span> Magnetization</a></li>
  </ul></li>
  <li><a href="#phase-transitions" id="toc-phase-transitions" class="nav-link" data-scroll-target="#phase-transitions"><span class="header-section-number">14.3</span> Phase Transitions</a></li>
  <li><a href="#gibbs-sampling" id="toc-gibbs-sampling" class="nav-link" data-scroll-target="#gibbs-sampling"><span class="header-section-number">14.4</span> Gibbs Sampling</a>
  <ul class="collapse">
  <li><a href="#conditional-distribution" id="toc-conditional-distribution" class="nav-link" data-scroll-target="#conditional-distribution"><span class="header-section-number">14.4.1</span> Conditional Distribution</a></li>
  </ul></li>
  <li><a href="#metropolis-hastings-algorithm" id="toc-metropolis-hastings-algorithm" class="nav-link" data-scroll-target="#metropolis-hastings-algorithm"><span class="header-section-number">14.5</span> Metropolis-Hastings Algorithm</a>
  <ul class="collapse">
  <li><a href="#the-algorithm" id="toc-the-algorithm" class="nav-link" data-scroll-target="#the-algorithm"><span class="header-section-number">14.5.1</span> The Algorithm</a></li>
  <li><a href="#energy-change-calculation" id="toc-energy-change-calculation" class="nav-link" data-scroll-target="#energy-change-calculation"><span class="header-section-number">14.5.2</span> Energy Change Calculation</a></li>
  <li><a href="#acceptance-probability" id="toc-acceptance-probability" class="nav-link" data-scroll-target="#acceptance-probability"><span class="header-section-number">14.5.3</span> Acceptance Probability</a></li>
  <li><a href="#the-algorithm-1" id="toc-the-algorithm-1" class="nav-link" data-scroll-target="#the-algorithm-1"><span class="header-section-number">14.5.4</span> The Algorithm</a></li>
  <li><a href="#comparison-with-gibbs-sampling" id="toc-comparison-with-gibbs-sampling" class="nav-link" data-scroll-target="#comparison-with-gibbs-sampling"><span class="header-section-number">14.5.5</span> Comparison with Gibbs Sampling</a></li>
  </ul></li>
  <li><a href="#wolff-algorithm-for-critical-temperature-sampling" id="toc-wolff-algorithm-for-critical-temperature-sampling" class="nav-link" data-scroll-target="#wolff-algorithm-for-critical-temperature-sampling"><span class="header-section-number">14.6</span> Wolff Algorithm for Critical Temperature Sampling</a>
  <ul class="collapse">
  <li><a href="#the-physical-motivation" id="toc-the-physical-motivation" class="nav-link" data-scroll-target="#the-physical-motivation"><span class="header-section-number">14.6.1</span> The Physical Motivation</a></li>
  <li><a href="#the-algorithm-2" id="toc-the-algorithm-2" class="nav-link" data-scroll-target="#the-algorithm-2"><span class="header-section-number">14.6.2</span> The Algorithm</a></li>
  <li><a href="#the-addition-probability" id="toc-the-addition-probability" class="nav-link" data-scroll-target="#the-addition-probability"><span class="header-section-number">14.6.3</span> The Addition Probability</a></li>
  <li><a href="#physical-interpretation-of-clusters" id="toc-physical-interpretation-of-clusters" class="nav-link" data-scroll-target="#physical-interpretation-of-clusters"><span class="header-section-number">14.6.4</span> Physical Interpretation of Clusters</a></li>
  <li><a href="#comparison-with-other-methods" id="toc-comparison-with-other-methods" class="nav-link" data-scroll-target="#comparison-with-other-methods"><span class="header-section-number">14.6.5</span> Comparison with Other Methods</a></li>
  </ul></li>
  <li><a href="#simulation-results" id="toc-simulation-results" class="nav-link" data-scroll-target="#simulation-results"><span class="header-section-number">14.7</span> Simulation Results</a></li>
  <li><a href="#final-remarks" id="toc-final-remarks" class="nav-link" data-scroll-target="#final-remarks"><span class="header-section-number">14.8</span> Final Remarks</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<script>
document.addEventListener("DOMContentLoaded", function() {
    // const issueLink = document.getElementById("report-issue-link");
    const issueLink = document.querySelector('a[href="https://github.com/apurvanakade/Monte-Carlo-Methods"]');
    if (issueLink) {
        const repoUrl = "https://github.com/apurvanakade/Monte-Carlo-Methods";
        const issueTitle = `Issue on page: ${document.title}`;
        let issueBody = "";
        document.addEventListener('selectionchange', function() {
          const selectedText = window.getSelection().toString();
          if (selectedText) {
            issueBody = `Selected text:\n${selectedText}`;
          } else {
            issueBody = "";
          }
          const fullIssueUrl = `${repoUrl}/issues/new?title=${encodeURIComponent(issueTitle)}&body=${encodeURIComponent(issueBody)}`;
          issueLink.href = fullIssueUrl;
        });
        const fullIssueUrl = `${repoUrl}/issues/new?title=${encodeURIComponent(issueTitle)}&body=${encodeURIComponent(issueBody)}`;
        issueLink.href = fullIssueUrl;
        issueLink.target = "_blank"; // Open in a new tab
    }
});


</script>

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/applications/SDE.html">Applications</a></li><li class="breadcrumb-item"><a href="../../chapters/applications/ising.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Ising Model</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Ising Model</span></h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 11, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="the-physical-ising-model" class="level2" data-number="14.1">
<h2 data-number="14.1" class="anchored" data-anchor-id="the-physical-ising-model"><span class="header-section-number">14.1</span> The Physical Ising Model</h2>
<p>The Ising model is a simple model of ferromagnetism from statistical mechanics. The setup is as follows:</p>
<ol type="1">
<li><strong>Particles</strong>: We have a lattice of <span class="math inline">\(N\)</span> particles, each of which can be have one of two states of magnetization: spin up (<span class="math inline">\(X = 1\)</span>) or spin down (<span class="math inline">\(X = -1\)</span>). For simplicity, we assume the grid is “wrapped” so that the top and bottom edges are connected, and the left and right edges are connected. <strong>This means that each site has four neighbors.</strong> Such a grid is called a torus.</li>
<li><strong>Coupling constant</strong>: Two adjacent particles have a tendency to have spins aligned. This tendency is quantified by a coupling constant <span class="math inline">\(J\)</span>. If two adjacent particles have the same spin, the energy of the system is lowered by <span class="math inline">\(-J\)</span>, and if they have opposite spins, the energy is raised by <span class="math inline">\(J\)</span>. Any physical system tends to minimize its energy, so the system will tend to have neighboring particles with the same spin.</li>
<li><strong>External magnetic field</strong>: For the same of simplicity we’ll assume that there is no external force field.</li>
<li><strong>Temperature</strong>: Temperature adds randomness to the system. At 0K, all the particles have their spins aligned. As the temperature increases, the particles start to flip their spins. The higher the temperature, the more likely it is for neighboring particles to have opposite spins.</li>
<li><strong>Magnetization</strong>: If the system is in a state where most of the particles have the same spin, the system is said to be magnetized.</li>
</ol>
<p>Next we create a mathematical model to describe the system.</p>
<div id="110fc3dd" class="cell" data-execution_count="3">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ising_files/figure-html/cell-3-output-1.png" width="466" height="463" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="the-mathematical-ising-model" class="level2" data-number="14.2">
<h2 data-number="14.2" class="anchored" data-anchor-id="the-mathematical-ising-model"><span class="header-section-number">14.2</span> The Mathematical Ising Model</h2>
<p>We model the system using <span class="math inline">\(N^2\)</span> random variables <span class="math inline">\(X_{i, j}\)</span>. Each <span class="math inline">\(X_{i, j}\)</span> is a binary random variable that takes the value <span class="math inline">\(1\)</span> or <span class="math inline">\(-1\)</span>. The configuration of the system is given by the <span class="math inline">\(N^2\)</span> length vector <span class="math inline">\(\mathbf{X} = (X_{1, 1}, X_{1, 2}, \ldots, X_{N, N})\)</span>. There are <span class="math inline">\(2^{N^2}\)</span> possible configurations of the system i.e.&nbsp;the state space has size <span class="math inline">\(2^{N^2}\)</span>. We can imagine each configuration as being the vertex of a hypercube in <span class="math inline">\(N^2\)</span> dimensions with vertices <span class="math inline">\((\pm 1, \pm 1, \ldots, \pm 1)\)</span>. We’ll let the variable <span class="math inline">\(\sigma\)</span> denote a configuration of the system. So <span class="math inline">\(\sigma\)</span> is a vector of length <span class="math inline">\(N^2\)</span> with entries in <span class="math inline">\(\{-1, 1\}\)</span>.</p>
<p>In order to describe the system mathematically, we need to provide the joint probability distribution of the random variables <span class="math inline">\(X_{i, j}\)</span>. This is done using the Hamiltonian of the system and the Boltzmann distribution.</p>
<section id="hamiltonian" class="level3" data-number="14.2.1">
<h3 data-number="14.2.1" class="anchored" data-anchor-id="hamiltonian"><span class="header-section-number">14.2.1</span> Hamiltonian</h3>
<p>The Hamiltonian of the system is given by</p>
<p><span class="math display">\[
H(\sigma) = -J \sum \limits_{(i, j) \text{ and } (i', j') \text{ are neighbors}} X_{i, j} X_{i', j'}
\]</span></p>
<p>where the sum is over all pairs of neighboring particles. The Hamiltonian is just a measure of the energy of the system. Note that because <span class="math inline">\(J\)</span> is positive, the energy is minimized when neighboring particles have the same spin.</p>
</section>
<section id="boltzmann-distribution" class="level3" data-number="14.2.2">
<h3 data-number="14.2.2" class="anchored" data-anchor-id="boltzmann-distribution"><span class="header-section-number">14.2.2</span> Boltzmann Distribution</h3>
<p>The probability of the system being in a particular configuration <span class="math inline">\(\sigma\)</span> is given by the Boltzmann distribution:</p>
<p><span class="math display">\[
f(\sigma) = \frac{e^{-H(\sigma)/T}}{Z}
\]</span></p>
<p>where <span class="math inline">\(T\)</span> is the temperature, and <span class="math inline">\(Z\)</span> is the normalization constant called the partition function. This is the joint probability mass function of the random variables <span class="math inline">\(X_{i, j}\)</span>. The partition function <span class="math inline">\(Z\)</span> is not easy to compute, but thankfully we do not need it to sample from the joint distribution.</p>
</section>
<section id="low-temperature" class="level3" data-number="14.2.3">
<h3 data-number="14.2.3" class="anchored" data-anchor-id="low-temperature"><span class="header-section-number">14.2.3</span> Low Temperature</h3>
<p>If we plugin the partition function explicitly, we can see that the probability distribution becomes</p>
<p><span class="math display">\[
f(\sigma) = \frac{e^{-H(\sigma)/T}}{\sum \limits_{\sigma'}e^{-H(\sigma')/T}}.
\]</span></p>
<p>As <span class="math inline">\(T \to 0\)</span>, the term with the highest value of <span class="math inline">\(-H(\sigma)\)</span> will dominate the sum in the denominator. But the term with the highest value of <span class="math inline">\(-H(\sigma)\)</span> is the one that minimizes <span class="math inline">\(H(\sigma)\)</span>. So,</p>
<p><span class="math display">\[
\lim \limits_{T \to \infty} f(\sigma) = \lim \limits_{T \to \infty}  \frac{e^{-H(\sigma)/T}}{e^{-H(\sigma)_{\min}/T}} = \lim \limits_{T \to \infty}  e^{(H(\sigma)_{\min} - H(\sigma))/T}.
\]</span></p>
<p>If <span class="math inline">\(H(\sigma)_{\min} = H(\sigma)\)</span>, then the probability of the system being in that state is <span class="math inline">\(1\)</span> and <span class="math inline">\(0\)</span> otherwise. This means that at low temperatures, the system will be in a state that minimizes the energy. But as <span class="math inline">\(T\)</span> increases, more and more high energy states become probable. So temperature can be thought of as adding variability to the system.</p>
</section>
<section id="magnetization" class="level3" data-number="14.2.4">
<h3 data-number="14.2.4" class="anchored" data-anchor-id="magnetization"><span class="header-section-number">14.2.4</span> Magnetization</h3>
<p>The magnetization of the system is given by</p>
<p><span class="math display">\[
M(\sigma) = \frac{1}{N^2} \sum \limits_{i, j} X_{i, j}
\]</span></p>
<p>If the system is magnetized, then <span class="math inline">\(M(\sigma)\)</span> will be close to <span class="math inline">\(1\)</span> or <span class="math inline">\(-1\)</span>. Our goal is to find the expected value of the magnetization of the system. To do this we need to sample from the distribution <span class="math inline">\(f(\sigma)\)</span> and then compute the magnetization of each sample. The average of these magnetizations will be the expected magnetization of the system.</p>
</section>
</section>
<section id="phase-transitions" class="level2" data-number="14.3">
<h2 data-number="14.3" class="anchored" data-anchor-id="phase-transitions"><span class="header-section-number">14.3</span> Phase Transitions</h2>
<p>It was discovered that the Ising model for a 2D grid exhibits a phenomenon called <strong>phase transition</strong>. If we slowly increase the temperature, we expect the magnetization to decrease. What is surprising is that the magnetization decreases smoothly until a certain temperature, after which it drops suddenly. This sudden drop is called a phase transition. The temperature at which this happens is called the <strong>critical temperature</strong>.</p>
<p>It is possible to calculate the critical temperature theoretically, in the limit when the size of the lattice <span class="math inline">\(\to \infty\)</span>. This limiting critical temperature for a square lattice is given by</p>
<p><span class="math display">\[
T_c = \dfrac{2J}{\log(1 + \sqrt{2})}.
\]</span></p>
<p>Of course, in our simulation, we’ll be using finite sized lattices so we should expect some deviation from this result.</p>
</section>
<section id="gibbs-sampling" class="level2" data-number="14.4">
<h2 data-number="14.4" class="anchored" data-anchor-id="gibbs-sampling"><span class="header-section-number">14.4</span> Gibbs Sampling</h2>
<p>There are two natural ways of sampling from the distribution <span class="math inline">\(f(\sigma)\)</span>: Metropolis-Hastings and Gibbs sampling. In the Metropolis-Hastings approach, we randomly choose a particle and flip its spin. We then accept or reject the new configuration based on the Metropolis-Hastings acceptance probability. In the Gibbs sampling approach, we update the entire grid of particles one at a time. We update each particle by sampling from the conditional distribution of that particle given the rest of the particles.</p>
<section id="conditional-distribution" class="level3" data-number="14.4.1">
<h3 data-number="14.4.1" class="anchored" data-anchor-id="conditional-distribution"><span class="header-section-number">14.4.1</span> Conditional Distribution</h3>
<p>Consider a single spin <span class="math inline">\(X_{i, j}\)</span>. Let <span class="math inline">\(\hat{X}_{i, j}\)</span> denote the set of spins at all sites except <span class="math inline">\((i, j)\)</span>. We want to find the conditional distribution of <span class="math inline">\(X_{i, j}\)</span> given <span class="math inline">\(\hat{X}_{i, j}\)</span>.</p>
<section id="derivation-from-boltzmann-distribution" class="level4" data-number="14.4.1.1">
<h4 data-number="14.4.1.1" class="anchored" data-anchor-id="derivation-from-boltzmann-distribution"><span class="header-section-number">14.4.1.1</span> Derivation from Boltzmann Distribution</h4>
<p>The conditional probability can be derived directly from the Boltzmann distribution. The key insight is that when we condition on all other spins, only the energy terms involving <span class="math inline">\(X_{i,j}\)</span> matter for the probability ratio.</p>
<p>The full Hamiltonian can be written as: <span class="math display">\[H(\sigma) = H_{\text{rest}} + H_{\text{local}}\]</span></p>
<p>where <span class="math inline">\(H_{\text{rest}}\)</span> contains all terms not involving <span class="math inline">\(X_{i,j}\)</span>, and <span class="math display">\[H_{\text{local}} = -J \cdot X_{i,j} \sum_{(i',j') \in \text{neighbors}(i,j)} X_{i',j'} = -X_{i,j} \cdot h_{i,j}\]</span></p>
<p>Here, <span class="math inline">\(h_{i,j} = J(X_{i-1,j} + X_{i+1,j} + X_{i,j-1} + X_{i,j+1})\)</span> is the <strong>effective field</strong> at site <span class="math inline">\((i,j)\)</span>.</p>
<p>Using the Boltzmann distribution: <span class="math display">\[P(X_{i,j} = s | \hat{X}_{i,j}) = \frac{e^{-H(\sigma)/T}}{e^{-H(\sigma_{+1})/T} + e^{-H(\sigma_{-1})/T}}\]</span></p>
<p>where <span class="math inline">\(\sigma_{+1}\)</span> and <span class="math inline">\(\sigma_{-1}\)</span> are configurations with <span class="math inline">\(X_{i,j} = +1\)</span> and <span class="math inline">\(X_{i,j} = -1\)</span> respectively.</p>
<p>Since <span class="math inline">\(H_{\text{rest}}\)</span> cancels out in the ratio: <span class="math display">\[P(X_{i,j} = +1 | \hat{X}_{i,j}) = \frac{e^{h_{i,j}/T}}{e^{h_{i,j}/T} + e^{-h_{i,j}/T}} = \frac{1}{1 + e^{-2h_{i,j}/T}}\]</span></p>
<p>Similarly: <span class="math display">\[P(X_{i,j} = -1 | \hat{X}_{i,j}) = \frac{e^{-h_{i,j}/T}}{e^{h_{i,j}/T} + e^{-h_{i,j}/T}} = \frac{1}{1 + e^{2h_{i,j}/T}}\]</span></p>
<p>This gives us our final result:</p>
<p><span id="eq-conditional"><span class="math display">\[
\begin{aligned}
P(X_{i, j} = 1 | \hat{X}_{i, j}) &amp;= \dfrac{1}{1 + \exp(-2 h_{i, j} / T)}, \\
P(X_{i, j} = -1 | \hat{X}_{i, j}) &amp;= 1 - P(X_{i, j} = 1 | \hat{X}_{i, j}).
\end{aligned}
\tag{14.1}\]</span></span></p>
<p>Thus the conditional distribution in <a href="#eq-conditional" class="quarto-xref">Equation&nbsp;<span>14.1</span></a> is a logistic function.</p>
</section>
<section id="physical-interpretation-of-the-effective-field" class="level4" data-number="14.4.1.2">
<h4 data-number="14.4.1.2" class="anchored" data-anchor-id="physical-interpretation-of-the-effective-field"><span class="header-section-number">14.4.1.2</span> Physical Interpretation of the Effective Field</h4>
<p>The effective field <span class="math inline">\(h_{i,j}\)</span> represents the “magnetic influence” of the neighboring spins:</p>
<ul>
<li>When <span class="math inline">\(h_{i,j} &gt; 0\)</span>: Most neighbors are spin-up (<span class="math inline">\(+1\)</span>), favoring <span class="math inline">\(X_{i,j} = +1\)</span></li>
<li>When <span class="math inline">\(h_{i,j} &lt; 0\)</span>: Most neighbors are spin-down (<span class="math inline">\(-1\)</span>), favoring <span class="math inline">\(X_{i,j} = -1\)</span><br>
</li>
<li>When <span class="math inline">\(h_{i,j} = 0\)</span>: Equal influence from up and down neighbors, so <span class="math inline">\(P(X_{i,j} = +1) = 0.5\)</span>.</li>
</ul>
<p>The temperature <span class="math inline">\(T\)</span> controls how strongly the system responds to this local field:</p>
<ul>
<li>Low <span class="math inline">\(T\)</span>: Sharp response, spins almost always align with neighbors</li>
<li>High <span class="math inline">\(T\)</span>: Weak response, spins behave more randomly regardless of neighbors.</li>
</ul>
</section>
</section>
</section>
<section id="metropolis-hastings-algorithm" class="level2" data-number="14.5">
<h2 data-number="14.5" class="anchored" data-anchor-id="metropolis-hastings-algorithm"><span class="header-section-number">14.5</span> Metropolis-Hastings Algorithm</h2>
<p>While Gibbs sampling updates spins by sampling from exact conditional distributions, the <strong>Metropolis-Hastings algorithm</strong> uses a different approach: it proposes random changes and accepts or rejects them based on how they affect the system’s energy.</p>
<section id="the-algorithm" class="level3" data-number="14.5.1">
<h3 data-number="14.5.1" class="anchored" data-anchor-id="the-algorithm"><span class="header-section-number">14.5.1</span> The Algorithm</h3>
<p>The Metropolis-Hastings algorithm for the Ising model works as follows:</p>
<ol type="1">
<li><strong>Proposal step</strong>: Randomly select a spin <span class="math inline">\(X_{i,j}\)</span> and propose flipping it: <span class="math inline">\(X_{i,j} \to -X_{i,j}\)</span></li>
<li><strong>Energy calculation</strong>: Compute the energy change <span class="math inline">\(\Delta E\)</span> caused by this flip</li>
<li><strong>Acceptance decision</strong>: Accept the flip with probability <span class="math inline">\(\min(1, e^{-\Delta E/T})\)</span></li>
<li><strong>Update</strong>: If accepted, flip the spin; if rejected, keep the current state</li>
</ol>
</section>
<section id="energy-change-calculation" class="level3" data-number="14.5.2">
<h3 data-number="14.5.2" class="anchored" data-anchor-id="energy-change-calculation"><span class="header-section-number">14.5.2</span> Energy Change Calculation</h3>
<p>When we flip spin <span class="math inline">\(X_{i,j}\)</span> from <span class="math inline">\(s\)</span> to <span class="math inline">\(-s\)</span>, only the energy terms involving this spin change. The energy change is:</p>
<p><span class="math display">\[\Delta E = E_{\text{new}} - E_{\text{old}} = -J(-s)\sum_{\text{neighbors}} X_{i',j'} - (-J \cdot s \sum_{\text{neighbors}} X_{i',j'})\]</span></p>
<p><span class="math display">\[\Delta E = 2J \cdot s \sum_{\text{neighbors}} X_{i',j'} = 2s \cdot h_{i,j}\]</span></p>
<p>where <span class="math inline">\(h_{i,j} = J(X_{i-1,j} + X_{i+1,j} + X_{i,j-1} + X_{i,j+1})\)</span> is the same effective field from Gibbs sampling.</p>
</section>
<section id="acceptance-probability" class="level3" data-number="14.5.3">
<h3 data-number="14.5.3" class="anchored" data-anchor-id="acceptance-probability"><span class="header-section-number">14.5.3</span> Acceptance Probability</h3>
<p>The Metropolis acceptance probability is: <span class="math display">\[P_{\text{accept}} = \min\left(1, e^{-\Delta E/T}\right) = \min\left(1, e^{-2s \cdot h_{i,j}/T}\right)\]</span></p>
<p>This has a simple interpretation:</p>
<ul>
<li><strong>Energy-lowering moves</strong> (<span class="math inline">\(\Delta E &lt; 0\)</span>): Always accepted (probability = 1)</li>
<li><strong>Energy-raising moves</strong> (<span class="math inline">\(\Delta E &gt; 0\)</span>): Accepted with probability <span class="math inline">\(e^{-\Delta E/T}\)</span></li>
</ul>
<p>Higher temperatures make the algorithm more likely to accept energy-raising moves, allowing exploration of higher-energy configurations.</p>
<div id="c717a478" class="cell" data-execution_count="4">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ising_files/figure-html/cell-4-output-1.png" width="589" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="the-algorithm-1" class="level3" data-number="14.5.4">
<h3 data-number="14.5.4" class="anchored" data-anchor-id="the-algorithm-1"><span class="header-section-number">14.5.4</span> The Algorithm</h3>
<ol type="1">
<li>Initialize the grid of spins <span class="math inline">\(X_i\)</span> for <span class="math inline">\(i = 1\)</span> to <span class="math inline">\(N\)</span> randomly.</li>
<li>For <span class="math inline">\(i = 1\)</span> to <span class="math inline">\(N\)</span>
<ol type="1">
<li>For <span class="math inline">\(j = 1\)</span> to <span class="math inline">\(N\)</span>
<ol type="1">
<li>Compute the effective field <span class="math inline">\(h_{i, j}\)</span>.</li>
<li>Generate a random number <span class="math inline">\(u\)</span> from a uniform distribution.</li>
<li>Set <span class="math inline">\(X_{i, j}\)</span> to <span class="math inline">\(1\)</span> if <span class="math inline">\(u &lt; \dfrac{1}{1 + \exp(-2 h_{i, j} / T)}\)</span> and <span class="math inline">\(-1\)</span> otherwise.</li>
</ol></li>
</ol></li>
<li>Compute the magnetization of the system.</li>
<li>Repeat steps 2 and 3.</li>
</ol>
</section>
<section id="comparison-with-gibbs-sampling" class="level3" data-number="14.5.5">
<h3 data-number="14.5.5" class="anchored" data-anchor-id="comparison-with-gibbs-sampling"><span class="header-section-number">14.5.5</span> Comparison with Gibbs Sampling</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 23%">
<col style="width: 38%">
<col style="width: 38%">
</colgroup>
<thead>
<tr class="header">
<th>Aspect</th>
<th style="text-align: center;">Gibbs Sampling</th>
<th style="text-align: center;">Metropolis-Hastings</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Update mechanism</td>
<td style="text-align: center;">Sample from exact conditional distribution</td>
<td style="text-align: center;">Propose and accept/reject</td>
</tr>
<tr class="even">
<td>Computational cost</td>
<td style="text-align: center;">Requires exponential (logistic) calculation</td>
<td style="text-align: center;">Simple energy difference</td>
</tr>
<tr class="odd">
<td>Acceptance rate</td>
<td style="text-align: center;">Always 100% (every update accepted)</td>
<td style="text-align: center;">Variable (depends on T and local environment)</td>
</tr>
<tr class="even">
<td>Implementation</td>
<td style="text-align: center;">More complex (logistic function)</td>
<td style="text-align: center;">Simpler (just energy differences)</td>
</tr>
<tr class="odd">
<td>Generalizability</td>
<td style="text-align: center;">Requires known conditional distributions</td>
<td style="text-align: center;">Works for any energy function</td>
</tr>
<tr class="even">
<td>Efficiency near T_c</td>
<td style="text-align: center;">Generally faster convergence</td>
<td style="text-align: center;">Can have low acceptance rates</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="wolff-algorithm-for-critical-temperature-sampling" class="level2" data-number="14.6">
<h2 data-number="14.6" class="anchored" data-anchor-id="wolff-algorithm-for-critical-temperature-sampling"><span class="header-section-number">14.6</span> Wolff Algorithm for Critical Temperature Sampling</h2>
<p>Near the critical temperature, both Gibbs sampling and single-spin Metropolis–Hastings suffer from <strong>critical slowing down</strong>.<br>
The correlation length <span class="math inline">\(\xi\)</span> diverges as <span class="math inline">\(\xi \sim |T - T_c|^{-\nu}\)</span>, causing spins to become highly correlated over large distances.<br>
Single-spin updates can no longer efficiently explore the configuration space because flipping individual spins disrupts large correlated regions, leading to extremely long equilibration times.</p>
<p>The <strong>Wolff algorithm</strong>, developed by Ulli Wolff in 1989, solves this problem by identifying and flipping entire <strong>clusters</strong> of aligned spins simultaneously, dramatically reducing critical slowing down at low temperatures and near the critical point.</p>
<section id="the-physical-motivation" class="level3" data-number="14.6.1">
<h3 data-number="14.6.1" class="anchored" data-anchor-id="the-physical-motivation"><span class="header-section-number">14.6.1</span> The Physical Motivation</h3>
<p>At low temperatures and near <span class="math inline">\(T_c\)</span>, the system develops large domains of aligned spins that fluctuate together as coherent units.<br>
Traditional single-spin algorithms fight against these natural correlations by attempting to flip spins one at a time.<br>
The Wolff algorithm instead:</p>
<ol type="1">
<li>Identifies clusters of spins that “want” to flip together<br>
</li>
<li>Respects the correlation structure by flipping entire domains<br>
</li>
<li>Maintains detailed balance while working with the physics rather than against it</li>
</ol>
<p>This approach is analogous to the difference between trying to turn a school of fish by grabbing individual fish versus guiding the entire school as a unit.</p>
</section>
<section id="the-algorithm-2" class="level3" data-number="14.6.2">
<h3 data-number="14.6.2" class="anchored" data-anchor-id="the-algorithm-2"><span class="header-section-number">14.6.2</span> The Algorithm</h3>
<ol type="1">
<li><p><strong>Seed selection:</strong> Randomly choose a starting spin <span class="math inline">\(s_0\)</span> at site <span class="math inline">\((i_0, j_0)\)</span>.</p></li>
<li><p><strong>Cluster growth:</strong> Use a breadth-first search (BFS) to grow a cluster:</p>
<ul>
<li>Initialize a queue with the seed spin.<br>
</li>
<li>Mark the seed as visited.<br>
</li>
<li>While the queue is not empty:
<ul>
<li>Remove a spin from the queue.<br>
</li>
<li>Examine each of its four neighbors.<br>
</li>
<li>If a neighbor has the same orientation as the original seed spin <strong>and</strong> has not been visited:
<ul>
<li>Add it to the cluster with probability <span class="math inline">\(P_{\text{add}} = 1 - e^{-2\beta J}\)</span>.</li>
<li>If added, mark as visited and add to the queue.</li>
</ul></li>
</ul></li>
</ul></li>
<li><p><strong>Cluster flip:</strong> Flip all spins in the identified cluster simultaneously.</p></li>
<li><p><strong>Acceptance:</strong> The move is always accepted (acceptance probability <span class="math inline">\(= 1\)</span>).</p></li>
</ol>
</section>
<section id="the-addition-probability" class="level3" data-number="14.6.3">
<h3 data-number="14.6.3" class="anchored" data-anchor-id="the-addition-probability"><span class="header-section-number">14.6.3</span> The Addition Probability</h3>
<p>The key insight is the addition probability $<span class="math inline">\(P_{\text{add}} = 1 - e^{-2\beta J}\)</span>. This probability is carefully chosen to maintain detailed balance and has intuitive temperature dependence.</p>
<section id="high-temperature-t-gg-t_c" class="level4" data-number="14.6.3.1">
<h4 data-number="14.6.3.1" class="anchored" data-anchor-id="high-temperature-t-gg-t_c"><span class="header-section-number">14.6.3.1</span> High temperature (<span class="math inline">\(T \gg T_c\)</span>):</h4>
<p><span class="math inline">\(\beta = \frac{1}{T} \text{ small} \quad \Rightarrow \quad
P_{\text{add}} \approx 2\beta J \approx 0.\)</span></p>
<ul>
<li>Clusters remain small, typically containing only 1–2 spins.<br>
</li>
<li>Behavior similar to single-spin updates.</li>
</ul>
</section>
<section id="low-temperature-t-ll-t_c" class="level4" data-number="14.6.3.2">
<h4 data-number="14.6.3.2" class="anchored" data-anchor-id="low-temperature-t-ll-t_c"><span class="header-section-number">14.6.3.2</span> Low temperature (<span class="math inline">\(T \ll T_c\)</span>):</h4>
<p><span class="math inline">\(P_{\text{add}} \approx 1 \quad (\text{since } 2\beta J \text{ is large}),\)</span></p>
<ul>
<li>Large aligned regions are almost always included in clusters.<br>
</li>
<li>Entire domains flip together efficiently, avoiding high-energy intermediate states.</li>
</ul>
</section>
<section id="critical-temperature-t-approx-t_c" class="level4" data-number="14.6.3.3">
<h4 data-number="14.6.3.3" class="anchored" data-anchor-id="critical-temperature-t-approx-t_c"><span class="header-section-number">14.6.3.3</span> Critical temperature (<span class="math inline">\(T \approx T_c\)</span>):</h4>
<ul>
<li><span class="math inline">\(P_{\text{add}}\)</span> takes intermediate values.<br>
</li>
<li>Cluster sizes automatically match the natural correlation length <span class="math inline">\(\xi\)</span>.<br>
</li>
<li>Optimal balance between exploration and respecting correlations.</li>
</ul>
</section>
</section>
<section id="physical-interpretation-of-clusters" class="level3" data-number="14.6.4">
<h3 data-number="14.6.4" class="anchored" data-anchor-id="physical-interpretation-of-clusters"><span class="header-section-number">14.6.4</span> Physical Interpretation of Clusters</h3>
<p>The clusters identified by the Wolff algorithm have physical meaning:</p>
<ul>
<li><strong>Small clusters</strong> (<span class="math inline">\(\text{size} \sim 1\)</span>): high-temperature regime, spins behave independently.<br>
</li>
<li><strong>Medium clusters</strong> (<span class="math inline">\(\text{size} \sim 10\)</span>–<span class="math inline">\(100\)</span>): intermediate correlations, local domains.<br>
</li>
<li><strong>Large clusters</strong> (<span class="math inline">\(\text{size} \sim L^2\)</span>): low temperature or near critical point, system-spanning correlations.<br>
</li>
<li><strong>Percolating clusters:</strong> clusters that wrap around periodic boundaries indicate long-range order.</li>
</ul>
<p>The average cluster size <span class="math inline">\(\langle s \rangle\)</span> is related to the magnetic susceptibility: <span class="math inline">\(\langle s \rangle \sim \chi \sim |T - T_c|^{-\gamma}\)</span>, providing a direct probe of critical behavior.</p>
</section>
<section id="comparison-with-other-methods" class="level3" data-number="14.6.5">
<h3 data-number="14.6.5" class="anchored" data-anchor-id="comparison-with-other-methods"><span class="header-section-number">14.6.5</span> Comparison with Other Methods</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Aspect</th>
<th>Single-Spin</th>
<th>Wolff Algorithm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Update size</strong></td>
<td>Always 1 spin</td>
<td>Variable (1 to L² spins)</td>
</tr>
<tr class="even">
<td><strong>Acceptance rate</strong></td>
<td>Variable (very low at low T)</td>
<td>Always 100%</td>
</tr>
<tr class="odd">
<td><strong>Critical slowing down</strong></td>
<td>Severe</td>
<td>Minimal</td>
</tr>
<tr class="even">
<td><strong>Implementation</strong></td>
<td>Simple</td>
<td>Moderate complexity</td>
</tr>
<tr class="odd">
<td><strong>Memory usage</strong></td>
<td>Minimal</td>
<td>Moderate (cluster storage)</td>
</tr>
<tr class="even">
<td><strong>Efficiency at high T</strong></td>
<td>Good</td>
<td>Similar</td>
</tr>
<tr class="odd">
<td><strong>Efficiency near T_c</strong></td>
<td>Very poor</td>
<td>Excellent</td>
</tr>
<tr class="even">
<td><strong>Efficiency at low T</strong></td>
<td>Poor</td>
<td>Excellent</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="simulation-results" class="level2" data-number="14.7">
<h2 data-number="14.7" class="anchored" data-anchor-id="simulation-results"><span class="header-section-number">14.7</span> Simulation Results</h2>
<p>Below are the results of simulating the Ising model on a <span class="math inline">\(20 \times 20\)</span> grid for <span class="math inline">\(J = 1\)</span>. The predicted critical temperature is <span class="math inline">\(T_c = 2.269\)</span>.</p>
<p>We can see that at <span class="math inline">\(T=1.5\)</span>, the system is magnetized and the magnetization is more or less constant and close to 1 or -1 over various runs. At <span class="math inline">\(T=2.5\)</span>, the system is not magnetized and the average magnetization is close to 0. It fluctuates wildly over various runs.</p>
<p>If we gradually increase the temperature from <span class="math inline">\(T=1\)</span> to <span class="math inline">\(T=3\)</span>, we can see that the magnetization decreases smoothly until <span class="math inline">\(T=2\)</span> after which it drops suddenly. This is the phase transition. Below the graph are the snapshots of the grid at different temperatures. One can see that at low temperatures, the grid is mostly monochromatic, but at high temperatures, the grid is more chaotic.</p>
<div id="7bf14f94" class="cell" data-execution_count="6">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ising_files/figure-html/cell-6-output-1.png" width="832" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ising_files/figure-html/cell-6-output-2.png" width="917" height="475" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="09641cc4" class="cell" data-execution_count="8">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ising_files/figure-html/cell-8-output-1.png" width="906" height="374" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="92f8d31d" class="cell" data-execution_count="10">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ising_files/figure-html/cell-10-output-1.png" width="906" height="374" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="final-remarks" class="level2" data-number="14.8">
<h2 data-number="14.8" class="anchored" data-anchor-id="final-remarks"><span class="header-section-number">14.8</span> Final Remarks</h2>
<p>Not all graphs show a phase transition. The Ising model in 1D has no phase transition at any temperature. It was conjectured that the Ising model in 2D has no phase transition either, but this was proven wrong when an analytical solution was found by Lars Onsager in 1944. The Ising model in 3D also has a phase transition, but the critical temperature is not known exactly. Most critical temperatures are only known for limiting cases when the size of the lattice goes to infinity. For finite cases, Monte Carlo simulations are the only way to estimate the critical temperature.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/applications/SDE.html" class="pagination-link" aria-label="Stochastic Differential Equations">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Stochastic Differential Equations</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/applications/mmn.html" class="pagination-link" aria-label="M/M/n Queue">
        <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">M/M/n Queue</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>© 2025 Apurva Nakade. All rights reserved.</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>