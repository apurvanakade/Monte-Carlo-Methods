<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Apurva Nakade">
<meta name="dcterms.date" content="2025-08-02">

<title>18&nbsp; Particle Filtering - Sequential Importance Sampling – Monte Carlo Methods Lecture Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/optimization/index.html" rel="next">
<link href="../../chapters/dynamical/kalman_filters.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ef56b68f8fa1e9d2ba328e99e439f80.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-db446d54fd5a772fc03f6e5780a6993c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-ee81c25b5e6cf3f6942c6f9c45799924.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-db446d54fd5a772fc03f6e5780a6993c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../style.css">
<meta property="og:title" content="18&nbsp; Particle Filtering - Sequential Importance Sampling – Monte Carlo Methods Lecture Notes">
<meta property="og:description" content="">
<meta property="og:image" content="particle_filters_files/figure-html/cell-3-output-1.png">
<meta property="og:site_name" content="Monte Carlo Methods Lecture Notes">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Monte Carlo Methods Lecture Notes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/apurvanakade/Monte-Carlo-Methods"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/dynamical/kalman_filters.html">Advanced Topics</a></li><li class="breadcrumb-item"><a href="../../chapters/dynamical/particle_filters.html"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Particle Filtering - Sequential Importance Sampling</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Welcome</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Monte Carlo Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Monte Carlo Estimation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/estimation/estimating_pi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Estimating <span class="math inline">\(\pi\)</span></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/estimation/integrals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Estimating Integrals</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/sampling/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampling Techniques</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sampling/rng.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Random Number Generators</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sampling/discrete.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Discrete Distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sampling/inverse_transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Inverse Transform Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sampling/other_distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Other Distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sampling/accept_reject.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Rejection Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sampling/gibbs_2d.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Gibbs Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/sampling/mh.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Metropolis–Hastings Algorithm</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/variance_reduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Variance Reduction Techniques</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Applications</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/applications/SDE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Stochastic Differential Equations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/applications/ising.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Ising Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/applications/bootstrap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Bootstrap</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/dynamical/particle_filters.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Particle Filtering - Sequential Importance Sampling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Optimization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../appendices/probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Review of Probability Theory</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../appendices/markov_chains.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Markov Chains</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../appendices/hidden_markov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Hidden Markov Chains</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">18.1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#the-challenge" id="toc-the-challenge" class="nav-link" data-scroll-target="#the-challenge"><span class="header-section-number">18.1.1</span> The Challenge</a></li>
  <li><a href="#the-particle-filter-solution" id="toc-the-particle-filter-solution" class="nav-link" data-scroll-target="#the-particle-filter-solution"><span class="header-section-number">18.1.2</span> The Particle Filter Solution</a></li>
  <li><a href="#applications" id="toc-applications" class="nav-link" data-scroll-target="#applications"><span class="header-section-number">18.1.3</span> Applications</a></li>
  </ul></li>
  <li><a href="#background-state-space-models-and-hidden-markov-models" id="toc-background-state-space-models-and-hidden-markov-models" class="nav-link" data-scroll-target="#background-state-space-models-and-hidden-markov-models"><span class="header-section-number">18.2</span> Background: State-Space Models and Hidden Markov Models</a>
  <ul class="collapse">
  <li><a href="#state-space-model-framework" id="toc-state-space-model-framework" class="nav-link" data-scroll-target="#state-space-model-framework"><span class="header-section-number">18.2.1</span> State-Space Model Framework</a></li>
  <li><a href="#probabilistic-formulation" id="toc-probabilistic-formulation" class="nav-link" data-scroll-target="#probabilistic-formulation"><span class="header-section-number">18.2.2</span> Probabilistic Formulation</a></li>
  <li><a href="#markov-assumptions" id="toc-markov-assumptions" class="nav-link" data-scroll-target="#markov-assumptions"><span class="header-section-number">18.2.3</span> Markov Assumptions</a></li>
  <li><a href="#hidden-markov-models-hmms" id="toc-hidden-markov-models-hmms" class="nav-link" data-scroll-target="#hidden-markov-models-hmms"><span class="header-section-number">18.2.4</span> Hidden Markov Models (HMMs)</a></li>
  <li><a href="#inference-problems" id="toc-inference-problems" class="nav-link" data-scroll-target="#inference-problems"><span class="header-section-number">18.2.5</span> Inference Problems</a></li>
  </ul></li>
  <li><a href="#particle-filtering-algorithm" id="toc-particle-filtering-algorithm" class="nav-link" data-scroll-target="#particle-filtering-algorithm"><span class="header-section-number">18.3</span> Particle Filtering Algorithm</a>
  <ul class="collapse">
  <li><a href="#the-bootstrap-filter---the-simple-case" id="toc-the-bootstrap-filter---the-simple-case" class="nav-link" data-scroll-target="#the-bootstrap-filter---the-simple-case"><span class="header-section-number">18.3.1</span> The Bootstrap Filter - The Simple Case</a></li>
  <li><a href="#general-formula---correcting-for-different-proposals" id="toc-general-formula---correcting-for-different-proposals" class="nav-link" data-scroll-target="#general-formula---correcting-for-different-proposals"><span class="header-section-number">18.3.2</span> General Formula - Correcting for Different Proposals</a></li>
  <li><a href="#effective-sample-size-and-resampling" id="toc-effective-sample-size-and-resampling" class="nav-link" data-scroll-target="#effective-sample-size-and-resampling"><span class="header-section-number">18.3.3</span> Effective Sample Size and Resampling</a></li>
  <li><a href="#particle-filtering-for-2d-object-tracking" id="toc-particle-filtering-for-2d-object-tracking" class="nav-link" data-scroll-target="#particle-filtering-for-2d-object-tracking"><span class="header-section-number">18.3.4</span> Particle Filtering for 2D Object Tracking</a></li>
  </ul></li>
  <li><a href="#particle-filter-implementation" id="toc-particle-filter-implementation" class="nav-link" data-scroll-target="#particle-filter-implementation"><span class="header-section-number">18.4</span> Particle Filter Implementation</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">18.5</span> Conclusion</a>
  <ul class="collapse">
  <li><a href="#key-strengths" id="toc-key-strengths" class="nav-link" data-scroll-target="#key-strengths"><span class="header-section-number">18.5.1</span> Key Strengths</a></li>
  <li><a href="#limitations-and-challenges" id="toc-limitations-and-challenges" class="nav-link" data-scroll-target="#limitations-and-challenges"><span class="header-section-number">18.5.2</span> Limitations and Challenges</a></li>
  <li><a href="#when-to-use-particle-filters" id="toc-when-to-use-particle-filters" class="nav-link" data-scroll-target="#when-to-use-particle-filters"><span class="header-section-number">18.5.3</span> When to Use Particle Filters</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<script>
document.addEventListener("DOMContentLoaded", function() {
    // const issueLink = document.getElementById("report-issue-link");
    const issueLink = document.querySelector('a[href="https://github.com/apurvanakade/Monte-Carlo-Methods"]');
    if (issueLink) {
        const repoUrl = "https://github.com/apurvanakade/Monte-Carlo-Methods";
        const issueTitle = `Issue on page: ${document.title}`;
        let issueBody = "";
        document.addEventListener('selectionchange', function() {
          const selectedText = window.getSelection().toString();
          if (selectedText) {
            issueBody = `Selected text:\n${selectedText}`;
          } else {
            issueBody = "";
          }
          const fullIssueUrl = `${repoUrl}/issues/new?title=${encodeURIComponent(issueTitle)}&body=${encodeURIComponent(issueBody)}`;
          issueLink.href = fullIssueUrl;
        });
        const fullIssueUrl = `${repoUrl}/issues/new?title=${encodeURIComponent(issueTitle)}&body=${encodeURIComponent(issueBody)}`;
        issueLink.href = fullIssueUrl;
        issueLink.target = "_blank"; // Open in a new tab
    }
});


</script>

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/dynamical/kalman_filters.html">Advanced Topics</a></li><li class="breadcrumb-item"><a href="../../chapters/dynamical/particle_filters.html"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Particle Filtering - Sequential Importance Sampling</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Particle Filtering - Sequential Importance Sampling</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Apurva Nakade </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 2, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2" data-number="18.1">
<h2 data-number="18.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">18.1</span> Introduction</h2>
<p>Particle filtering, also known as Sequential Monte Carlo (SMC) or Sequential Importance Sampling, is a powerful computational method for performing inference in dynamic systems where we have:</p>
<ol type="1">
<li><strong>Sequential observations</strong> arriving over time</li>
<li><strong>Hidden state variables</strong> that evolve according to some dynamics</li>
<li><strong>Nonlinear or non-Gaussian</strong> relationships that make analytical solutions intractable</li>
</ol>
<p>Consider a hidden Markov model where we observe a sequence <span class="math inline">\(\mathbf{y}_{1:T} = \{\mathbf{y}_1, \mathbf{y}_2, \ldots, \mathbf{y}_T\}\)</span> and want to infer the hidden states <span class="math inline">\(\mathbf{x}_{1:T} = \{\mathbf{x}_1, \mathbf{x}_2, \ldots, \mathbf{x}_T\}\)</span>. The system is characterized by:</p>
<ul>
<li><strong>State transition model</strong>: <span class="math inline">\(p(\mathbf{x}_t | \mathbf{x}_{t-1})\)</span> - how the hidden state evolves</li>
<li><strong>Observation model</strong>: <span class="math inline">\(p(\mathbf{y}_t | \mathbf{x}_t)\)</span> - how observations relate to hidden states<br>
</li>
<li><strong>Initial state distribution</strong>: <span class="math inline">\(p(\mathbf{x}_0)\)</span></li>
</ul>
<p>Our goal is to compute the <strong>filtering distribution</strong> <span class="math inline">\(p(\mathbf{x}_t | \mathbf{y}_{1:t})\)</span>, which represents our belief about the current state given all observations up to time <span class="math inline">\(t\)</span>.</p>
<section id="the-challenge" class="level3" data-number="18.1.1">
<h3 data-number="18.1.1" class="anchored" data-anchor-id="the-challenge"><span class="header-section-number">18.1.1</span> The Challenge</h3>
<p>For linear-Gaussian systems, the Kalman filter provides an exact analytical solution. However, for nonlinear or non-Gaussian systems, the filtering distribution cannot be computed analytically. The key challenges are:</p>
<ol type="1">
<li><strong>Intractable integrals</strong>: Computing <span class="math inline">\(p(\mathbf{x}_t | \mathbf{y}_{1:t})\)</span> requires high-dimensional integration</li>
<li><strong>Sequential nature</strong>: We need real-time updates as new observations arrive</li>
<li><strong>Curse of dimensionality</strong>: Grid-based methods become infeasible in high dimensions</li>
</ol>
</section>
<section id="the-particle-filter-solution" class="level3" data-number="18.1.2">
<h3 data-number="18.1.2" class="anchored" data-anchor-id="the-particle-filter-solution"><span class="header-section-number">18.1.2</span> The Particle Filter Solution</h3>
<p>Particle filters address these challenges by representing the filtering distribution using a set of <strong>particles</strong> (samples) with associated <strong>weights</strong>:</p>
<p><span class="math display">\[
p(\mathbf{x}_t | \mathbf{y}_{1:t}) \approx \sum_{i=1}^{N} w_t^{(i)} \delta(\mathbf{x}_t - \mathbf{x}_t^{(i)}),
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\{\mathbf{x}_t^{(i)}\}_{i=1}^{N}\)</span> are particles representing possible states</li>
<li><span class="math inline">\(\{w_t^{(i)}\}_{i=1}^{N}\)</span> are normalized weights such that <span class="math inline">\(\sum_{i=1}^{N} w_t^{(i)} = 1\)</span></li>
<li><span class="math inline">\(\delta(\cdot)\)</span> is the Dirac delta function</li>
</ul>
<p>This Monte Carlo approximation allows us to:</p>
<ul>
<li>Handle arbitrary nonlinearities and noise distributions</li>
<li>Update beliefs sequentially as new data arrives</li>
<li>Compute expectations: <span class="math inline">\(\mathbb{E}[f(\mathbf{x}_t) | \mathbf{y}_{1:t}] \approx \sum_{i=1}^{N} w_t^{(i)} f(\mathbf{x}_t^{(i)})\)</span></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Key Insight</strong>: Particle filters extend importance sampling to sequential settings, where we maintain and update a particle approximation over time rather than drawing fresh samples for each time step.</p>
</div>
</div>
</section>
<section id="applications" class="level3" data-number="18.1.3">
<h3 data-number="18.1.3" class="anchored" data-anchor-id="applications"><span class="header-section-number">18.1.3</span> Applications</h3>
<p>Particle filters are widely used in:</p>
<ul>
<li><strong>Object tracking</strong> in computer vision</li>
<li><strong>Robot localization</strong> and SLAM (Simultaneous Localization and Mapping)</li>
<li><strong>Financial modeling</strong> with stochastic volatility</li>
<li><strong>Signal processing</strong> and communications</li>
<li><strong>Epidemiological modeling</strong> and disease spread</li>
<li><strong>Weather forecasting</strong> and climate modeling</li>
</ul>
<p>The flexibility to handle complex, nonlinear dynamics makes particle filters indispensable when Kalman filters fail.</p>
</section>
</section>
<section id="background-state-space-models-and-hidden-markov-models" class="level2" data-number="18.2">
<h2 data-number="18.2" class="anchored" data-anchor-id="background-state-space-models-and-hidden-markov-models"><span class="header-section-number">18.2</span> Background: State-Space Models and Hidden Markov Models</h2>
<section id="state-space-model-framework" class="level3" data-number="18.2.1">
<h3 data-number="18.2.1" class="anchored" data-anchor-id="state-space-model-framework"><span class="header-section-number">18.2.1</span> State-Space Model Framework</h3>
<p>A <strong>state-space model</strong> (SSM) provides a general framework for modeling dynamic systems with hidden states. The model consists of two key components:</p>
<p><strong>State Evolution (Process Model)</strong>: <span class="math display">\[
\mathbf{x}_t = \mathbf{f}_t(\mathbf{x}_{t-1}, \mathbf{v}_t),
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\mathbf{x}_t \in \mathbb{R}^{d_x}\)</span> is the hidden state at time <span class="math inline">\(t\)</span></li>
<li><span class="math inline">\(\mathbf{f}_t(\cdot, \cdot)\)</span> is the state transition function (possibly time-varying)</li>
<li><span class="math inline">\(\mathbf{v}_t\)</span> is the process noise</li>
</ul>
<p><strong>Observation Model (Measurement Model)</strong>: <span class="math display">\[
\mathbf{y}_t = \mathbf{h}_t(\mathbf{x}_t, \mathbf{w}_t),
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\mathbf{y}_t \in \mathbb{R}^{d_y}\)</span> is the observation at time <span class="math inline">\(t\)</span></li>
<li><span class="math inline">\(\mathbf{h}_t(\cdot, \cdot)\)</span> is the observation function (possibly time-varying)</li>
<li><span class="math inline">\(\mathbf{w}_t\)</span> is the observation noise</li>
</ul>
<p>The noise terms <span class="math inline">\(\mathbf{v}_t\)</span> and <span class="math inline">\(\mathbf{w}_t\)</span> are typically assumed to be independent across time and mutually independent, though their distributions can be arbitrary.</p>
</section>
<section id="probabilistic-formulation" class="level3" data-number="18.2.2">
<h3 data-number="18.2.2" class="anchored" data-anchor-id="probabilistic-formulation"><span class="header-section-number">18.2.2</span> Probabilistic Formulation</h3>
<p>In probabilistic terms, the state-space model is characterized by:</p>
<p><strong>State Transition Density</strong>: <span class="math display">\[
p(\mathbf{x}_t | \mathbf{x}_{t-1}) = p(\mathbf{x}_t | \mathbf{x}_{t-1}, \boldsymbol{\theta}),
\]</span></p>
<p><strong>Observation Density</strong>: <span class="math display">\[
p(\mathbf{y}_t | \mathbf{x}_t) = p(\mathbf{y}_t | \mathbf{x}_t, \boldsymbol{\theta}),
\]</span></p>
<p><strong>Initial State Distribution</strong>: <span class="math display">\[
p(\mathbf{x}_0) = p(\mathbf{x}_0 | \boldsymbol{\theta}),
\]</span></p>
<p>where <span class="math inline">\(\boldsymbol{\theta}\)</span> represents model parameters (assumed known for now).</p>
</section>
<section id="markov-assumptions" class="level3" data-number="18.2.3">
<h3 data-number="18.2.3" class="anchored" data-anchor-id="markov-assumptions"><span class="header-section-number">18.2.3</span> Markov Assumptions</h3>
<p>The state-space model embodies two crucial Markov assumptions:</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Markov Property for States</strong>: The future state depends only on the current state, not the entire history: <span class="math display">\[
p(\mathbf{x}_t | \mathbf{x}_{0:t-1}) = p(\mathbf{x}_t | \mathbf{x}_{t-1})
\]</span></p>
<p><strong>Conditional Independence of Observations</strong>: Given the current state, the observation is independent of all other states and observations: <span class="math display">\[
p(\mathbf{y}_t | \mathbf{x}_{0:t}, \mathbf{y}_{1:t-1}) = p(\mathbf{y}_t | \mathbf{x}_t)
\]</span></p>
</div>
</div>
<p>These assumptions lead to the <strong>joint distribution</strong> of states and observations:</p>
<p><span class="math display">\[
p(\mathbf{x}_{0:T}, \mathbf{y}_{1:T}) = p(\mathbf{x}_0) \prod_{t=1}^{T} p(\mathbf{x}_t | \mathbf{x}_{t-1}) p(\mathbf{y}_t | \mathbf{x}_t)
\]</span></p>
</section>
<section id="hidden-markov-models-hmms" class="level3" data-number="18.2.4">
<h3 data-number="18.2.4" class="anchored" data-anchor-id="hidden-markov-models-hmms"><span class="header-section-number">18.2.4</span> Hidden Markov Models (HMMs)</h3>
<p>When the state space is <strong>discrete</strong> and <strong>finite</strong>, i.e., <span class="math inline">\(x_t \in \{1, 2, \ldots, K\}\)</span>, the state-space model becomes a <strong>Hidden Markov Model</strong>. HMMs are characterized by:</p>
<p><strong>Transition Matrix</strong>: <span class="math display">\[
A_{ij} = P(x_t = j | x_{t-1} = i), \quad \sum_{j=1}^{K} A_{ij} = 1
\]</span></p>
<p><strong>Emission Matrix</strong>: <span class="math display">\[
B_{jk} = P(y_t = k | x_t = j) \quad \text{(for discrete observations)}
\]</span></p>
<p><strong>Initial Distribution</strong>: <span class="math display">\[
\pi_i = P(x_0 = i), \quad \sum_{i=1}^{K} \pi_i = 1
\]</span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example: Weather Tracking
</div>
</div>
<div class="callout-body-container callout-body">
<p>Consider a simple weather model where:</p>
<ul>
<li>Hidden states: <span class="math inline">\(x_t \in \{\text{Sunny}, \text{Rainy}\}\)</span></li>
<li>Observations: <span class="math inline">\(y_t \in \{\text{Dry}, \text{Wet}\}\)</span> (ground condition)</li>
</ul>
<p>The transition matrix might be: <span class="math display">\[
\mathbf{A} = \begin{pmatrix}
0.8 &amp; 0.2 \\
0.3 &amp; 0.7
\end{pmatrix}
\]</span></p>
<p>The emission matrix might be: <span class="math display">\[
\mathbf{B} = \begin{pmatrix}
0.9 &amp; 0.1 \\
0.2 &amp; 0.8
\end{pmatrix}
\]</span></p>
<p>This captures the intuition that sunny days tend to follow sunny days, and wet ground is more likely when it’s raining.</p>
</div>
</div>
<div id="exm-object-tracking" class="theorem example">
<p><span class="theorem-title"><strong>Example 18.1 (Example: 2D Object Tracking)</strong></span> Consider tracking a moving object (e.g., aircraft, vehicle, or person) in a 2D plane using noisy position measurements from sensors like radar or GPS.</p>
<p><strong>State</strong>: Position and velocity <span class="math inline">\(\mathbf{x}_t = [p_x, p_y, v_x, v_y]^{\top} \in \mathbb{R}^4\)</span></p>
<p><strong>State Evolution</strong>: The object follows a constant velocity model with random acceleration disturbances: <span class="math display">\[
\mathbf{x}_t = \mathbf{F} \mathbf{x}_{t-1} + \mathbf{G} \mathbf{a}_t
\]</span></p>
<p>where: <span class="math display">\[
\mathbf{F} = \begin{pmatrix}
1 &amp; 0 &amp; \Delta t &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; \Delta t \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{pmatrix}, \quad
\mathbf{G} = \begin{pmatrix}
\frac{(\Delta t)^2}{2} &amp; 0 \\
0 &amp; \frac{(\Delta t)^2}{2} \\
\Delta t &amp; 0 \\
0 &amp; \Delta t
\end{pmatrix}
\]</span></p>
<p>and <span class="math inline">\(\mathbf{a}_t = [a_x, a_y]^{\top} \sim \mathcal{N}(\mathbf{0}, \sigma_a^2 \mathbf{I})\)</span> represents random acceleration.</p>
<p><strong>Observations</strong>: Noisy position measurements from sensors: <span class="math display">\[
\mathbf{y}_t = \mathbf{H} \mathbf{x}_t + \mathbf{w}_t = \begin{pmatrix} 1 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 1 &amp; 0 &amp; 0 \end{pmatrix} \mathbf{x}_t + \mathbf{w}_t
\]</span></p>
<p>where <span class="math inline">\(\mathbf{w}_t \sim \mathcal{N}(\mathbf{0}, \mathbf{R})\)</span> with <span class="math inline">\(\mathbf{R} = \text{diag}(\sigma_x^2, \sigma_y^2)\)</span>.</p>
</div>
</section>
<section id="inference-problems" class="level3" data-number="18.2.5">
<h3 data-number="18.2.5" class="anchored" data-anchor-id="inference-problems"><span class="header-section-number">18.2.5</span> Inference Problems</h3>
<p>Given the state-space model, we are interested in several inference problems:</p>
<p><strong>1. Filtering</strong>: Estimate the current state given past and current observations: <span class="math display">\[
p(\mathbf{x}_t | \mathbf{y}_{1:t})
\]</span></p>
<p><strong>2. Prediction</strong>: Predict future states given current information: <span class="math display">\[
p(\mathbf{x}_{t+k} | \mathbf{y}_{1:t}), \quad k &gt; 0
\]</span></p>
<p><strong>3. Smoothing</strong>: Estimate past states given all observations: <span class="math display">\[
p(\mathbf{x}_t | \mathbf{y}_{1:T}), \quad t &lt; T
\]</span></p>
<p><strong>4. Marginal Likelihood</strong>: Compute the probability of the observed sequence: <span class="math display">\[
p(\mathbf{y}_{1:T}) = \int p(\mathbf{x}_{0:T}, \mathbf{y}_{1:T}) d\mathbf{x}_{0:T}
\]</span></p>
</section>
</section>
<section id="particle-filtering-algorithm" class="level2" data-number="18.3">
<h2 data-number="18.3" class="anchored" data-anchor-id="particle-filtering-algorithm"><span class="header-section-number">18.3</span> Particle Filtering Algorithm</h2>
<section id="the-bootstrap-filter---the-simple-case" class="level3" data-number="18.3.1">
<h3 data-number="18.3.1" class="anchored" data-anchor-id="the-bootstrap-filter---the-simple-case"><span class="header-section-number">18.3.1</span> The Bootstrap Filter - The Simple Case</h3>
<p>The most intuitive approach is the bootstrap filter. Here, we generate new particles by simply following the natural dynamics of the system (the state evolution model), then update weights based on how well each particle explains the new observation.</p>
<p><strong>Bootstrap Weight Update</strong>: <span class="math display">\[
\boxed{\tilde{w}_t^{(i)} \propto w_{t-1}^{(i)} \cdot p(\mathbf{y}_t | \mathbf{x}_t^{(i)})}
\]</span></p>
<p><strong>What this means</strong>:</p>
<ul>
<li><span class="math inline">\(w_{t-1}^{(i)}\)</span>: Previous weight of particle <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(p(\mathbf{y}_t | \mathbf{x}_t^{(i)})\)</span>: <strong>Likelihood</strong> - How well particle <span class="math inline">\(i\)</span> explains the new observation</li>
<li>Particles that better match the observation get higher weights</li>
<li>We normalize so all weights sum to 1: <span class="math inline">\(w_t^{(i)} = \tilde{w}_t^{(i)} / \sum_{j=1}^N \tilde{w}_t^{(j)}\)</span></li>
</ul>
<p><strong>Why This Works</strong>: We’re essentially asking “given what we observed, which particles were in the right place?” Particles that predicted something close to the actual observation become more important.</p>
</section>
<section id="general-formula---correcting-for-different-proposals" class="level3" data-number="18.3.2">
<h3 data-number="18.3.2" class="anchored" data-anchor-id="general-formula---correcting-for-different-proposals"><span class="header-section-number">18.3.2</span> General Formula - Correcting for Different Proposals</h3>
<p>Sometimes we want to be smarter about where we place new particles instead of just following the natural dynamics. We might use a <strong>proposal distribution</strong> <span class="math inline">\(q(\mathbf{x}_t^{(i)} | \cdot)\)</span> that incorporates the current observation to guide particles toward more promising regions.</p>
<p><strong>Why Use a Different Proposal?</strong></p>
<ul>
<li><strong>Bootstrap problem</strong>: If the observation is very informative but the system dynamics are very noisy, most particles following natural dynamics will end up far from where the observation suggests they should be.</li>
<li><strong>Efficiency</strong>: We waste computational effort on particles that will get very low weights.</li>
<li><strong>Better exploration</strong>: A good proposal can guide particles toward regions that are both dynamically plausible AND consistent with the observation.</li>
<li><strong>Computational efficiency</strong>: It might be computationally expensive to evolve many particles according to the state evolution model.</li>
</ul>
<p><strong>Example</strong>: If you are tracking an object in the 2D plane that usually moves slowly, but you suddenly observe it far from where you expected. The bootstrap filter would propose particles near the previous location (following slow dynamics), but they’d all get low weights. A smarter proposal would generate particles closer to where the observation suggests the object actually is.</p>
<p>When we do this, we need to correct our weights using <strong>importance sampling</strong>:</p>
<p><span class="math display">\[
\boxed{\tilde{w}_t^{(i)} \propto w_{t-1}^{(i)} \cdot p(\mathbf{y}_t | \mathbf{x}_t^{(i)}) \cdot \frac{ p(\mathbf{x}_t^{(i)} | \mathbf{x}_{t-1}^{(i)})}{q(\mathbf{x}_t^{(i)} | \mathbf{x}_{0:t-1}^{(i)}, \mathbf{y}_{1:t})}}
\]</span></p>
<p><strong>What the correction does</strong>:</p>
<ul>
<li><span class="math inline">\(p(\mathbf{x}_t^{(i)} | \mathbf{x}_{t-1}^{(i)})\)</span>: <strong>Transition probability</strong> - How likely this particle movement is under the true dynamics</li>
<li><span class="math inline">\(q(\mathbf{x}_t^{(i)} | \cdot)\)</span>: <strong>Proposal probability</strong> - How likely this particle movement is under our artificial proposal</li>
<li>The ratio <span class="math inline">\(\frac{p(\cdot)}{q(\cdot)}\)</span> corrects for the bias introduced by not sampling from the natural dynamics</li>
</ul>
<p><strong>Intuition</strong>: If we artificially push particles toward certain regions (high <span class="math inline">\(q\)</span>), we need to down-weight them proportionally. If we place particles in regions that are naturally likely (high <span class="math inline">\(p\)</span>), we up-weight them.</p>
<p>The bootstrap filter is the special case where <span class="math inline">\(q(\mathbf{x}_t^{(i)} | \cdot) = p(\mathbf{x}_t^{(i)} | \mathbf{x}_{t-1}^{(i)})\)</span>, so the transition probabilities cancel out and we get the simpler formula.</p>
</section>
<section id="effective-sample-size-and-resampling" class="level3" data-number="18.3.3">
<h3 data-number="18.3.3" class="anchored" data-anchor-id="effective-sample-size-and-resampling"><span class="header-section-number">18.3.3</span> Effective Sample Size and Resampling</h3>
<p>The <strong>effective sample size</strong> <span class="math inline">\(N_{\text{eff}} = 1/\sum_{i=1}^N (w_t^{(i)})^2\)</span> measures particle diversity, with <span class="math inline">\(N_{\text{eff}} = 1\)</span> indicating complete degeneracy (one particle has weight 1) and <span class="math inline">\(N_{\text{eff}} = N\)</span> indicating uniform weights.</p>
<p><strong>Connection to Variance</strong>: The effective sample size is inversely related to the variance of the weight distribution. For a discrete probability mass function with weights <span class="math inline">\(\{w^{(i)}\}\)</span>, the variance is:</p>
<p><span class="math display">\[\text{Var}(w) = \sum_{i=1}^N (w^{(i)})^2 - \left(\sum_{i=1}^N w^{(i)}\right)^2\]</span></p>
<p>Since the weights are normalized (<span class="math inline">\(\sum_{i=1}^N w^{(i)} = 1\)</span>), this becomes:</p>
<p><span class="math display">\[\text{Var}(w) = \sum_{i=1}^N (w^{(i)})^2 - 1\]</span></p>
<p>Therefore: <span class="math inline">\(\sum_{i=1}^N (w^{(i)})^2 = \text{Var}(w) + 1\)</span></p>
<p>This shows that <span class="math inline">\(N_{\text{eff}} = \frac{1}{\text{Var}(w) + 1}\)</span>, meaning:</p>
<ul>
<li><strong>High variance</strong> in weights → <strong>Low</strong> <span class="math inline">\(N_{\text{eff}}\)</span> → Few effective particles</li>
<li><strong>Low variance</strong> in weights → <strong>High</strong> <span class="math inline">\(N_{\text{eff}}\)</span> → Many effective particles</li>
</ul>
<p>When weights are highly unequal (high variance), most particles contribute little to the approximation, reducing the effective sample size. When weights are nearly uniform (low variance), all particles contribute meaningfully.</p>
<p><strong>Resampling</strong> fixes the weight imbalance by creating a new set of particles <span class="math inline">\(\{\tilde{\mathbf{x}}_t^{(i)}\}_{i=1}^N\)</span>. We randomly select particles based on their weights - particles with higher weights get picked more often, while particles with low weights may be discarded.</p>
<p>We draw <span class="math inline">\(N\)</span> new particles from the current set, where each particle’s chance of being selected equals its weight. A particle with weight 0.4 has a 40% chance of being chosen on each draw. After resampling all particles get equal weight <span class="math inline">\(w_t^{(i)} = 1/N\)</span> since they now represent an unweighted sample from our belief distribution.</p>
<p>Resampling solves the weight problem (restores <span class="math inline">\(N_{\text{eff}} = N\)</span>) but introduces randomness. Sometimes good particles are lost by bad luck, and we end up with multiple copies of the same particle, reducing diversity.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Bootstrap Particle Filter Algorithm
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Input</strong>: <span class="math inline">\(\{\mathbf{x}_0^{(i)}, w_0^{(i)} = 1/N\}_{i=1}^N\)</span>, observations <span class="math inline">\(\mathbf{y}_{1:T}\)</span></p>
<p><strong>For</strong> <span class="math inline">\(t = 1, \ldots, T\)</span>:</p>
<ol type="1">
<li><strong>Predict</strong>: For <span class="math inline">\(i = 1, \ldots, N\)</span>: <span class="math inline">\(\mathbf{x}_t^{(i)} \sim p(\mathbf{x}_t | \mathbf{x}_{t-1}^{(i)})\)</span></li>
<li><strong>Weight</strong>: For <span class="math inline">\(i = 1, \ldots, N\)</span>: <span class="math inline">\(\tilde{w}_t^{(i)} = w_{t-1}^{(i)} \cdot p(\mathbf{y}_t | \mathbf{x}_t^{(i)})\)</span></li>
<li><strong>Normalize</strong>: For <span class="math inline">\(i = 1, \ldots, N\)</span>: <span class="math inline">\(w_t^{(i)} = \tilde{w}_t^{(i)} / \sum_{j=1}^N \tilde{w}_t^{(j)}\)</span></li>
<li><strong>Resample</strong>: If <span class="math inline">\(N_{\text{eff}} = 1/\sum_{i=1}^N (w_t^{(i)})^2 &lt; N_{\text{threshold}}\)</span>:
<ul>
<li>Draw <span class="math inline">\(\{\tilde{\mathbf{x}}_t^{(i)}\}_{i=1}^N\)</span> from <span class="math inline">\(\{\mathbf{x}_t^{(i)}\}_{i=1}^N\)</span> with probabilities <span class="math inline">\(\{w_t^{(i)}\}_{i=1}^N\)</span></li>
<li>Set <span class="math inline">\(\mathbf{x}_t^{(i)} = \tilde{\mathbf{x}}_t^{(i)}\)</span> and <span class="math inline">\(w_t^{(i)} = 1/N\)</span> for all <span class="math inline">\(i\)</span></li>
</ul></li>
</ol>
<p><strong>Output</strong>: <span class="math inline">\(p(\mathbf{x}_t | \mathbf{y}_{1:t}) \approx \sum_{i=1}^N w_t^{(i)} \delta(\mathbf{x}_t - \mathbf{x}_t^{(i)})\)</span></p>
</div>
</div>
</section>
<section id="particle-filtering-for-2d-object-tracking" class="level3" data-number="18.3.4">
<h3 data-number="18.3.4" class="anchored" data-anchor-id="particle-filtering-for-2d-object-tracking"><span class="header-section-number">18.3.4</span> Particle Filtering for 2D Object Tracking</h3>
<p><strong>Weight Update Derivation</strong>: For the bootstrap proposal <span class="math inline">\(q(\mathbf{x}_t | \mathbf{x}_{t-1}, \mathbf{y}_{1:t}) = p(\mathbf{x}_t | \mathbf{x}_{t-1})\)</span>, the weight update simplifies to:</p>
<p><span class="math display">\[
\tilde{w}_t^{(i)} = w_{t-1}^{(i)} \cdot p(\mathbf{y}_t | \mathbf{x}_t^{(i)})
\]</span></p>
<p>For the tracking model, the likelihood is:</p>
<p><span class="math display">\[
p(\mathbf{y}_t | \mathbf{x}_t^{(i)}) = \mathcal{N}(\mathbf{y}_t; \mathbf{H} \mathbf{x}_t^{(i)}, \mathbf{R})
\]</span></p>
<p>where <span class="math inline">\(\mathbf{H} \mathbf{x}_t^{(i)} = [p_x^{(i)}, p_y^{(i)}]^{\top}\)</span> extracts the position components from the state vector <span class="math inline">\(\mathbf{x}_t^{(i)} = [p_x^{(i)}, p_y^{(i)}, v_x^{(i)}, v_y^{(i)}]^{\top}\)</span>. The observation residual is:</p>
<p><span class="math display">\[
\mathbf{r}_t^{(i)} = \mathbf{y}_t - \mathbf{H} \mathbf{x}_t^{(i)} = \begin{pmatrix} y_{x,t} - p_x^{(i)} \\ y_{y,t} - p_y^{(i)} \end{pmatrix}
\]</span></p>
<p>Therefore, the weight update becomes:</p>
<p><span class="math display">\[
\tilde{w}_t^{(i)} = w_{t-1}^{(i)} \cdot \mathcal{N}(\mathbf{y}_t; \mathbf{H} \mathbf{x}_t^{(i)}, \mathbf{R}) = w_{t-1}^{(i)} \cdot \frac{1}{\sqrt{(2\pi)^2 |\mathbf{R}|}} \exp\left(-\frac{1}{2} (\mathbf{r}_t^{(i)})^{\top} \mathbf{R}^{-1} \mathbf{r}_t^{(i)}\right)
\]</span></p>
<p><strong>Bootstrap Particle Filter Algorithm for Object Tracking</strong>:</p>
<p><strong>Input</strong>: <span class="math inline">\(\{\mathbf{x}_0^{(i)}, w_0^{(i)} = 1/N\}_{i=1}^N\)</span>, observations <span class="math inline">\(\mathbf{y}_{1:T}\)</span></p>
<p><strong>For</strong> <span class="math inline">\(t = 1, \ldots, T\)</span>:</p>
<ol type="1">
<li><p><strong>Predict</strong>: For <span class="math inline">\(i = 1, \ldots, N\)</span>: <span class="math display">\[\mathbf{x}_t^{(i)} = \mathbf{F} \mathbf{x}_{t-1}^{(i)} + \boldsymbol{\epsilon}_t^{(i)}, \quad \boldsymbol{\epsilon}_t^{(i)} \sim \mathcal{N}(\mathbf{0}, \mathbf{Q})\]</span></p></li>
<li><p><strong>Weight</strong>: For <span class="math inline">\(i = 1, \ldots, N\)</span>: <span class="math display">\[\tilde{w}_t^{(i)} = w_{t-1}^{(i)} \cdot \mathcal{N}(\mathbf{y}_t; \mathbf{H} \mathbf{x}_t^{(i)}, \mathbf{R})\]</span></p></li>
<li><p><strong>Normalize</strong>: For <span class="math inline">\(i = 1, \ldots, N\)</span>: <span class="math display">\[w_t^{(i)} = \frac{\tilde{w}_t^{(i)}}{\sum_{j=1}^N \tilde{w}_t^{(j)}}\]</span></p></li>
<li><p><strong>Estimate</strong>: <span class="math display">\[\hat{\mathbf{x}}_t = \sum_{i=1}^N w_t^{(i)} \mathbf{x}_t^{(i)}\]</span></p></li>
<li><p><strong>Resample</strong>: If <span class="math inline">\(N_{\text{eff}} = 1/\sum_{i=1}^N (w_t^{(i)})^2 &lt; N_{\text{threshold}}\)</span>:</p>
<ul>
<li>Draw <span class="math inline">\(\{\tilde{\mathbf{x}}_t^{(i)}\}_{i=1}^N\)</span> from <span class="math inline">\(\{\mathbf{x}_t^{(i)}\}_{i=1}^N\)</span> with probabilities <span class="math inline">\(\{w_t^{(i)}\}_{i=1}^N\)</span></li>
<li>Set <span class="math inline">\(\mathbf{x}_t^{(i)} = \tilde{\mathbf{x}}_t^{(i)}\)</span> and <span class="math inline">\(w_t^{(i)} = 1/N\)</span> for all <span class="math inline">\(i\)</span></li>
</ul></li>
</ol>
<p><strong>Output</strong>: Position estimate <span class="math inline">\(\hat{\mathbf{p}}_t = [\hat{p}_{x,t}, \hat{p}_{y,t}]^{\top}\)</span> and velocity estimate <span class="math inline">\(\hat{\mathbf{v}}_t = [\hat{v}_{x,t}, \hat{v}_{y,t}]^{\top}\)</span></p>
</section>
</section>
<section id="particle-filter-implementation" class="level2" data-number="18.4">
<h2 data-number="18.4" class="anchored" data-anchor-id="particle-filter-implementation"><span class="header-section-number">18.4</span> Particle Filter Implementation</h2>
<p>The following implementation demonstrates a complete particle filter for 2D object tracking. The demonstration tracks an object moving in 2D space with:</p>
<ul>
<li><strong>Process noise</strong>: Models random accelerations (<span class="math inline">\(\sigma_a = 0.5\)</span>)</li>
<li><strong>Observation noise</strong>: GPS-like position measurements (<span class="math inline">\(\sigma_r = 1.0\)</span>)</li>
<li><strong>Particles</strong>: 500 particles provide good approximation quality</li>
<li><strong>Duration</strong>: 30 time steps with unit time intervals</li>
</ul>
<p>The visualization shows the particle filter’s ability to track the true trajectory despite noisy observations, with automatic resampling maintaining particle diversity throughout the simulation.</p>
<div id="bee5d1f3" class="cell" data-execution_count="3">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="particle_filters_files/figure-html/cell-3-output-1.png" width="1430" height="1141" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Particle Filter Performance:
  Number of particles: 500
  Final position error: 2.276
  Mean position error: 1.097
  Resampling frequency: 24/30 time steps</code></pre>
</div>
</div>
</section>
<section id="conclusion" class="level2" data-number="18.5">
<h2 data-number="18.5" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">18.5</span> Conclusion</h2>
<p>Particle filters provide a powerful and flexible framework for tracking hidden states in complex dynamic systems. Unlike the Kalman filter, which requires linear dynamics and Gaussian noise, particle filters can handle arbitrary nonlinearities and any noise distribution by representing beliefs as a cloud of weighted samples.</p>
<section id="key-strengths" class="level3" data-number="18.5.1">
<h3 data-number="18.5.1" class="anchored" data-anchor-id="key-strengths"><span class="header-section-number">18.5.1</span> Key Strengths</h3>
<ul>
<li><strong>Flexibility</strong>: Works with any state evolution and observation model.</li>
<li><strong>Intuitive</strong>: The particle representation mirrors how we naturally think about uncertainty.</li>
<li><strong>Scalable</strong>: Performance degrades gracefully as system complexity increases.</li>
<li><strong>Real-time capable</strong>: Sequential updates make it suitable for online applications.</li>
</ul>
</section>
<section id="limitations-and-challenges" class="level3" data-number="18.5.2">
<h3 data-number="18.5.2" class="anchored" data-anchor-id="limitations-and-challenges"><span class="header-section-number">18.5.2</span> Limitations and Challenges</h3>
<ul>
<li><strong>Computational cost</strong>: Requires many particles for good approximation, especially in high dimensions.</li>
<li><strong>Sample impoverishment</strong>: Resampling can reduce particle diversity over time.</li>
<li><strong>Curse of dimensionality</strong>: Performance degrades exponentially with state dimension.</li>
<li><strong>Tuning required</strong>: Number of particles and resampling thresholds need careful selection.</li>
</ul>
</section>
<section id="when-to-use-particle-filters" class="level3" data-number="18.5.3">
<h3 data-number="18.5.3" class="anchored" data-anchor-id="when-to-use-particle-filters"><span class="header-section-number">18.5.3</span> When to Use Particle Filters</h3>
<p>Particle filters excel when:</p>
<ul>
<li>The system is <strong>nonlinear</strong> or has <strong>non-Gaussian noise</strong>.</li>
<li>You need <strong>real-time</strong> state estimation.</li>
<li>The state space is <strong>moderate dimensional</strong> (typically &lt; 10-20 dimensions).</li>
<li><strong>Computational resources</strong> are available for running many particles.</li>
</ul>
<p>Consider alternatives when:</p>
<ul>
<li>The system is linear-Gaussian (use Kalman filter).</li>
<li>The state space is very high-dimensional (consider ensemble methods).</li>
<li>Computational resources are severely limited.</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/dynamical/kalman_filters.html" class="pagination-link" aria-label="Kalman Filters">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Kalman Filters</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/optimization/index.html" class="pagination-link" aria-label="Optimization">
        <span class="nav-page-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Optimization</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>© 2025 Apurva Nakade. All rights reserved.</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>