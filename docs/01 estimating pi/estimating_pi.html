<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monte Carlo Estimation of π</title>
    <style>
        #canvas {
            transition: opacity 0.2s ease-in-out;
        }
        #canvas.updating {
            opacity: 0.6;
        }
    </style>
</head>
<body>
<script async src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>

<div style="margin: 20px 0;">
    <label for="n-slider">Sample Size (N):</label>
    <input type="range" id="n-slider" min="10" max="10000" step="100" value="1000" style="width: 300px;">
    <span id="n-value" style="margin-left: 10px; font-weight: bold;">1,000</span>
</div>

<div id="loading" style="padding: 20px; text-align: center;">
    <p>Loading Python environment...</p>
</div>

<div id="main-content" style="display: none; margin: 20px 0;">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: start;">
        <div>
            <canvas id="canvas" style="border: 1px solid #ccc;"></canvas>
        </div>
        
        <div>
            <h3>Results</h3>
            <table style="width: 100%; border-collapse: collapse;">
                <tr style="border-bottom: 1px solid #ddd;">
                    <td style="padding: 8px;">Sample Size:</td>
                    <td style="padding: 8px; font-weight: bold;" id="stat-n">-</td>
                </tr>
                <tr style="border-bottom: 1px solid #ddd;">
                    <td style="padding: 8px;">Points Inside:</td>
                    <td style="padding: 8px; font-weight: bold;" id="stat-inside">-</td>
                </tr>
                <tr style="border-bottom: 1px solid #ddd;">
                    <td style="padding: 8px;">π Estimate:</td>
                    <td style="padding: 8px; font-weight: bold;" id="stat-estimate">-</td>
                </tr>
                <tr style="border-bottom: 1px solid #ddd;">
                    <td style="padding: 8px;">True π:</td>
                    <td style="padding: 8px; font-weight: bold;" id="stat-true">-</td>
                </tr>
                <tr style="border-bottom: 1px solid #ddd;">
                    <td style="padding: 8px;">Absolute Error:</td>
                    <td style="padding: 8px; font-weight: bold;" id="stat-error">-</td>
                </tr>
                <tr>
                    <td style="padding: 8px;">Standard Error:</td>
                    <td style="padding: 8px; font-weight: bold;" id="stat-stderr">-</td>
                </tr>
            </table>
        </div>
    </div>
</div>

<script type="module">
    import { initPyodide, debouncedUpdate, renderImageToCanvas, updateStats } from './estimating_pi_app.js';

    const canvas = document.getElementById('canvas');

    async function handleSliderChange(e) {
        const N = parseInt(e.target.value);
        document.getElementById('n-value').textContent = N.toLocaleString();
        
        // Visual feedback while updating
        canvas.classList.add('updating');
        
        debouncedUpdate(N, (data) => {
            renderImageToCanvas(canvas, data.image);
            updateStats(data, N);
            canvas.classList.remove('updating');
        });
    }

    async function init() {
        try {
            await initPyodide();
            
            document.getElementById('loading').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            
            document.getElementById('n-slider').addEventListener('input', handleSliderChange);
            
            // Initial render
            const { updatePlot } = await import('./estimating_pi_app.js');
            const data = await updatePlot(1000);
            if (data) {
                renderImageToCanvas(canvas, data.image);
                updateStats(data, 1000);
            }
        } catch (err) {
            console.error('Failed to initialize app:', err);
            document.getElementById('loading').innerHTML = '<p>Error loading Python environment</p>';
        }
    }

    window.addEventListener('load', init);
</script>

</body>
</html>

